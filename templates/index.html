<!doctype html>
<html>

	<head>
		<title>Secret Movie Room</title>

		<script type="text/javascript" src="/static/js/jquery-2.0.2.min.js"></script>
		<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/_ah/channel/jsapi"></script>
		<script type="text/javascript" src="/static/js/video.dev.js"></script>
		<link rel="stylesheet" href="/static/css/bootstrap.css">
		<link rel="stylesheet" href="/static/css/video-js.css">
	</head>

	<body>
		<div id="display">
			{{ room_id }}
			{{ token }}
			{{ client_id }}
		</div>

		<input id="message" type="text" class="input-medium search-query">
		<button id="submit" type="submit" class="btn">Search</button>

		<div><a href="/?room_id={{room_id}}">localhost:10080/?room_id={{room_id}}</a></div>
		<div id="status"></div>

		<video id="player" class="video-js vjs-default-skin"
		  controls preload="auto" width="640" height="264"
		  data-setup='{ "controls": true, "autoplay": false, "preload": "auto" }'>
		 <source src="http://ddmm37kppyxwy.cloudfront.net/Daft%20Punk%20-%20Get%20Lucky%20__%20George%20Barnett%20cover.mp4" type='video/mp4' />
		</video>

		<!-- Video.js Scripts -->
		<script type="text/javascript">
		videojs.options.flash.swf = "/static/video-js.swf"


		</script>


		<!-- Channel API Scripts -->
		<script type="text/javascript">
			var token = '{{ token }}';
			var room_id = '{{ room_id }}';
			var client_id = '{{ client_id }}';

			var onMessage = function(m) {
				if (m.data.indexOf('connected') !== -1) {
					//presence message
					$('#status').text(m.data);
				} else {
					//update message
					$('#display').text(m.data);
				}				
			}

			channel = new goog.appengine.Channel('{{ token }}');
			socket = channel.open();

			socket.onmessage = onMessage;

			$('#submit').click(function(e){
	            e.preventDefault();
	            var message = $('#message').val();
	            $.post('/update', {room_id: room_id, message: message});
	        });
		</script>

	</body>

</html>